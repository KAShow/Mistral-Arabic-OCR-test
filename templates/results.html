{% extends "base.html" %}

{% block title %}Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«: {{ query }} - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†ÙŠØ©{% endblock %}

{% block content %}
<div class="search-container">
    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© -->
    <form method="post" action="/search" id="searchForm">
        <div class="search-box">
            <div class="d-flex">
                <input 
                    type="text" 
                    name="query" 
                    class="search-input" 
                    value="{{ query }}"
                    placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ†..."
                    required
                    autocomplete="off"
                >
                <button type="submit" class="search-btn">
                    <i class="fas fa-search me-2"></i>Ø¨Ø­Ø«
                </button>
            </div>
        </div>
    </form>
    
    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
    <div class="mt-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4>
                <i class="fas fa-search-plus me-2"></i>
                Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: <span class="text-primary">"{{ query }}"</span>
            </h4>
            <span class="badge bg-primary fs-6">{{ total_results }} Ù†ØªÙŠØ¬Ø©</span>
        </div>
        
        {% if total_results == 0 %}
        <!-- Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ -->
        <div class="alert alert-warning">
            <h5><i class="fas fa-exclamation-triangle me-2"></i>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬</h5>
            <p class="mb-0">Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ù†ØªØ§Ø¦Ø¬ ØªØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ "<strong>{{ query }}</strong>"</p>
            
            <div class="mt-3">
                <h6>Ø¬Ø±Ø¨ Ø§Ù„Ù†ØµØ§Ø¦Ø­ Ø§Ù„ØªØ§Ù„ÙŠØ©:</h6>
                <ul>
                    <li>ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¥Ù…Ù„Ø§Ø¡</li>
                    <li>Ø§Ø³ØªØ®Ø¯Ù… ÙƒÙ„Ù…Ø§Øª Ø£Ø¨Ø³Ø· Ø£Ùˆ Ø£ÙƒØ«Ø± Ø¹Ù…ÙˆÙ…ÙŠØ©</li>
                    <li>Ø¬Ø±Ø¨ Ù…Ø±Ø§Ø¯ÙØ§Øª Ø£Ùˆ ÙƒÙ„Ù…Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©</li>
                    <li>Ù‚Ù„Ù„ Ù…Ù† Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙÙŠ Ø§Ù„Ø¨Ø­Ø«</li>
                </ul>
            </div>
        </div>
        
        <!-- Ø£Ù…Ø«Ù„Ø© Ù„Ù„Ø¨Ø­Ø« -->
        <div class="mt-4">
            <h5><i class="fas fa-lightbulb me-2"></i>Ø¬Ø±Ø¨ Ù‡Ø°Ù‡ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª:</h5>
            <div class="d-flex flex-wrap gap-2">
                <span class="badge bg-secondary search-example" data-query="Ø§Ù„Ø¹Ø§Ù…Ù„">Ø§Ù„Ø¹Ø§Ù…Ù„</span>
                <span class="badge bg-secondary search-example" data-query="ØµØ§Ø­Ø¨ Ø§Ù„Ø¹Ù…Ù„">ØµØ§Ø­Ø¨ Ø§Ù„Ø¹Ù…Ù„</span>
                <span class="badge bg-secondary search-example" data-query="Ø§Ù„Ø£Ø¬Ø±">Ø§Ù„Ø£Ø¬Ø±</span>
                <span class="badge bg-secondary search-example" data-query="Ø¹Ù‚Ø¯ Ø§Ù„Ø¹Ù…Ù„">Ø¹Ù‚Ø¯ Ø§Ù„Ø¹Ù…Ù„</span>
                <span class="badge bg-secondary search-example" data-query="Ø§Ù„ÙˆØ²Ø§Ø±Ø©">Ø§Ù„ÙˆØ²Ø§Ø±Ø©</span>
            </div>
        </div>
        
        {% else %}
        <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        {% for result in results %}
        <div class="result-card">
            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ø¯Ø© -->
            <div class="result-meta">
                <span><i class="fas fa-file-alt me-1"></i>{{ result.document_name }}</span>
                <span><i class="fas fa-file-pdf me-1"></i>ØµÙØ­Ø© {{ result.page_number }}</span>
                
                {% if result.article_number %}
                <span><i class="fas fa-paragraph me-1"></i>Ø§Ù„Ù…Ø§Ø¯Ø© ({{ result.article_number }})</span>
                {% endif %}
                
                {% if result.chapter %}
                <span><i class="fas fa-book me-1"></i>{{ result.chapter }}</span>
                {% endif %}
                
                {% if result.section %}
                <span><i class="fas fa-bookmark me-1"></i>{{ result.section }}</span>
                {% endif %}
                
                <span class="badge 
                    {% if result.article_type == 'article' %}bg-success
                    {% elif result.article_type == 'definition' %}bg-info
                    {% else %}bg-secondary
                    {% endif %}">
                    {% if result.article_type == 'article' %}Ù…Ø§Ø¯Ø© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©
                    {% elif result.article_type == 'definition' %}ØªØ¹Ø±ÙŠÙ
                    {% else %}Ù†Øµ Ø¹Ø§Ù…
                    {% endif %}
                </span>
            </div>
            
            <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆÙØ±Ø§Ù‹ -->
            {% if result.title %}
            <h6 class="text-primary mb-2">{{ result.title }}</h6>
            {% endif %}
            
            <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
            <div class="result-content">
                {% if result.highlighted_content %}
                    {{ result.highlighted_content | safe }}
                {% else %}
                    {{ result.content }}
                {% endif %}
            </div>
            
            <!-- Ø±Ø§Ø¨Ø· Ù„Ù„Ù…Ø§Ø¯Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© -->
            <div class="mt-2">
                <a href="/page/{{ result.document_name }}/{{ result.page_number }}?highlight={{ query }}" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-eye me-1"></i>Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©
                </a>
            </div>
        </div>
        {% endfor %}
        
        <!-- Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <div class="mt-4">
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                ØªÙ… Ø¹Ø±Ø¶ {{ total_results }} Ù†ØªÙŠØ¬Ø©. 
                Ø¥Ø°Ø§ Ù„Ù… ØªØ¬Ø¯ Ù…Ø§ ØªØ¨Ø­Ø« Ø¹Ù†Ù‡ØŒ Ø¬Ø±Ø¨ ÙƒÙ„Ù…Ø§Øª Ù…Ø®ØªÙ„ÙØ© Ø£Ùˆ Ø£ÙƒØ«Ø± ØªØ­Ø¯ÙŠØ¯Ø§Ù‹.
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="text-center mt-4">
        <a href="/" class="btn btn-secondary">
            <i class="fas fa-home me-2"></i>Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹ Ù„Ù„Ø£Ù…Ø«Ù„Ø©
document.querySelectorAll('.search-example').forEach(function(badge) {
    badge.style.cursor = 'pointer';
    badge.addEventListener('click', function() {
        const query = this.getAttribute('data-query');
        document.querySelector('input[name="query"]').value = query;
        document.getElementById('searchForm').submit();
    });
});

// ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
document.querySelectorAll('.result-content').forEach(function(content) {
    // ØªØ­Ø¯ÙŠØ¯ Ø·ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶
    const maxLength = 300;
    if (content.textContent.length > maxLength) {
        const originalText = content.innerHTML;
        const shortText = content.textContent.substring(0, maxLength) + '...';
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø²Ø± "Ø§Ù„Ù…Ø²ÙŠØ¯"
        const moreBtn = document.createElement('button');
        moreBtn.className = 'btn btn-link btn-sm p-0 ms-2';
        moreBtn.innerHTML = '<i class="fas fa-chevron-down me-1"></i>Ø§Ù„Ù…Ø²ÙŠØ¯';
        moreBtn.onclick = function() {
            if (content.dataset.expanded === 'true') {
                content.innerHTML = shortText;
                content.appendChild(moreBtn);
                moreBtn.innerHTML = '<i class="fas fa-chevron-down me-1"></i>Ø§Ù„Ù…Ø²ÙŠØ¯';
                content.dataset.expanded = 'false';
            } else {
                content.innerHTML = originalText;
                const lessBtn = document.createElement('button');
                lessBtn.className = 'btn btn-link btn-sm p-0 ms-2';
                lessBtn.innerHTML = '<i class="fas fa-chevron-up me-1"></i>Ø£Ù‚Ù„';
                lessBtn.onclick = function() {
                    content.innerHTML = shortText;
                    content.appendChild(moreBtn);
                    content.dataset.expanded = 'false';
                };
                content.appendChild(lessBtn);
                content.dataset.expanded = 'true';
            }
        };
        
        content.innerHTML = shortText;
        content.appendChild(moreBtn);
        content.dataset.expanded = 'false';
    }
});

// ØªÙ…ÙŠÙŠØ² ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
const searchQuery = "{{ query }}".toLowerCase();
const searchWords = searchQuery.split(' ').filter(word => word.length > 2);

document.querySelectorAll('.result-content').forEach(function(content) {
    let html = content.innerHTML;
    
    searchWords.forEach(function(word) {
        const regex = new RegExp(`(${word})`, 'gi');
        html = html.replace(regex, '<mark class="highlight">$1</mark>');
    });
    
    content.innerHTML = html;
});
</script>
{% endblock %}
